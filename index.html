<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TV de Gráficos</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #000;
      overflow: hidden;
    }

    #stage {
      position: fixed;
      inset: 0;
      overflow: hidden;
      background: #000;
    }

    iframe {
      position: absolute;
      inset: 0;
      width: 100vw;
      height: 100vh;
      border: 0;
      display: block;
    }

    .badge {
      position: fixed; top: 10px; left: 10px;
      color: #fff; font: 14px Arial, sans-serif;
      background: rgba(0,0,0,.45); padding: 6px 10px; border-radius: 10px;
      z-index: 9999;
      user-select: none;
    }

    .progress-wrap {
      position: fixed;
      left: 0; right: 0; bottom: 0;
      height: 8px;
      background: rgba(255,255,255,.18);
      z-index: 9999;
    }
    .progress-bar {
      height: 100%;
      width: 100%;
      background: rgba(70,70,70,0.95);
      transform-origin: left center;
      transform: scaleX(1);
    }

    /* ===== Overlay nas bordas para swipe/tap (não depende do iframe) ===== */
    .edge {
      position: fixed;
      top: 0;
      height: 100vh;
      width: 12vw;          /* ajuste: 10vw–18vw */
      z-index: 9998;        /* abaixo do badge e da barra, acima do iframe */
      background: rgba(255,255,255,0); /* invisível */
      touch-action: none;   /* garante que o browser não “roube” o gesto */
    }
    #edgeLeft  { left: 0; }
    #edgeRight { right: 0; }

    /* opcional: se quiser “ver” as bordas pra testar, descomente
    .edge { background: rgba(255,0,0,0.08); }
    */
  </style>
</head>
<body>
  <div class="badge" id="badge"></div>

  <div id="stage">
    <iframe id="frame" allowfullscreen></iframe>
  </div>

  <!-- bordas invisíveis pra capturar gesto -->
  <div class="edge" id="edgeLeft"  aria-label="Anterior"></div>
  <div class="edge" id="edgeRight" aria-label="Próximo"></div>

  <div class="progress-wrap">
    <div class="progress-bar" id="progress"></div>
  </div>

  <script>
    const URLS = [
     

"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=1375987279",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=181392821",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=1377967419",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=989494084",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=409465462",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=1464654695",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vSePvDhgfqtEf49n0yzoxCYmzR53HTyvrJQ9a4gf8T03-cpkSPoH1rwlACeeDVeLpMIqmnHDJnHU4wY/pubhtml#gid=1781419413",

"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=82066333",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=219207332",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=34100657",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=285689922",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=1817641505",
"https://docs.google.com/spreadsheets/d/e/2PACX-1vRnL9qLyOpMIB4Sko6Dk0Vz1sRgdUhCy9bVz1Kd30dmAjqOlxxwpCO2yVcV9dX8wVWW9OrhdMbEc4jT/pubhtml#gid=423305502",


    ];

    const INTERVALO_MS = 30_000;
    const ZOOM = 1.00;

    const frame = document.getElementById("frame");
    const badge = document.getElementById("badge");
    const progress = document.getElementById("progress");

    const edgeLeft = document.getElementById("edgeLeft");
    const edgeRight = document.getElementById("edgeRight");

    let i = 0;
    let startTime = 0;
    let rafId = 0;
    let paused = false;

    function applyZoom() {
      frame.style.transformOrigin = "center center";
      frame.style.transform = `scale(${ZOOM})`;
    }

    function setProgress(fracRemaining) {
      const v = Math.max(0, Math.min(1, fracRemaining));
      progress.style.transform = `scaleX(${v})`;
    }

    function makeUrl(original) {
      const parts = original.split("#");
      const base = parts[0];
      const hash = parts[1] ? "#" + parts[1] : "";

      const url = new URL(base);
      url.searchParams.set("_ts", Date.now());
      return url.toString() + hash;
    }

    function renderBadge() {
      const status = paused ? "PAUSADO" : "AUTO";
      // dica de uso mobile incluída
      badge.textContent = `Gráfico ${i + 1} / ${URLS.length} • ${status} • bordas: ← → • P pausa`;
    }

    function loadCurrent() {
      frame.src = makeUrl(URLS[i]);
      applyZoom();
      renderBadge();
    }

    function startCycle() {
      cancelAnimationFrame(rafId);
      startTime = performance.now();
      setProgress(1);

      if (!paused) rafId = requestAnimationFrame(tick);
      else setProgress(1);
    }

    function goTo(index, { restartTimer = true } = {}) {
      const n = URLS.length;
      if (n === 0) return;
      i = ((index % n) + n) % n;
      loadCurrent();
      if (restartTimer) startCycle();
    }

    function next({ restartTimer = true } = {}) { goTo(i + 1, { restartTimer }); }
    function prev({ restartTimer = true } = {}) { goTo(i - 1, { restartTimer }); }

    function tick(now) {
      const elapsed = now - startTime;
      const remaining = INTERVALO_MS - elapsed;

      setProgress(remaining / INTERVALO_MS);

      if (remaining <= 0) {
        cancelAnimationFrame(rafId);
        setProgress(0);
        next({ restartTimer: true });
        return;
      }
      rafId = requestAnimationFrame(tick);
    }

    function togglePause() {
      paused = !paused;
      cancelAnimationFrame(rafId);
      renderBadge();
      if (!paused) startCycle();
    }

    // Teclas (PC/TV Box)
    window.addEventListener("keydown", (e) => {
      const key = e.key;
      const blockKeys = ["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," ","PageUp","PageDown","Home","End","Backspace"];
      if (blockKeys.includes(key)) e.preventDefault();

      if (key === "ArrowRight" || key === "ArrowDown" || key === "PageDown" || key === " ") next({ restartTimer: true });
      else if (key === "ArrowLeft" || key === "ArrowUp" || key === "PageUp" || key === "Backspace") prev({ restartTimer: true });
      else if (key === "Home") goTo(0, { restartTimer: true });
      else if (key === "End") goTo(URLS.length - 1, { restartTimer: true });
      else if (key === "p" || key === "P") togglePause();
    }, { passive: false });

    // ======= Swipe e Tap nas bordas (mobile) =======
    function attachSwipe(el, direction) {
      let sx = 0, sy = 0, st = 0, moved = false;

      const MIN_X = 40;
      const MAX_Y = 120;
      const MAX_MS = 900;

      el.addEventListener("touchstart", (e) => {
        if (!e.touches || e.touches.length !== 1) return;
        const t = e.touches[0];
        sx = t.clientX;
        sy = t.clientY;
        st = Date.now();
        moved = false;
      }, { passive: true });

      el.addEventListener("touchmove", (e) => {
        moved = true;
      }, { passive: true });

      el.addEventListener("touchend", (e) => {
        const t = (e.changedTouches && e.changedTouches[0]) ? e.changedTouches[0] : null;
        if (!t) return;

        const dx = t.clientX - sx;
        const dy = t.clientY - sy;
        const dt = Date.now() - st;

        // Tap simples (sem swipe) também navega
        const isTap = !moved || (Math.abs(dx) < 10 && Math.abs(dy) < 10);

        if (isTap) {
          direction === "next" ? next({ restartTimer: true }) : prev({ restartTimer: true });
          return;
        }

        // Swipe horizontal claro
        if (dt > MAX_MS) return;
        if (Math.abs(dx) < MIN_X) return;
        if (Math.abs(dy) > MAX_Y) return;

        // Se arrastou “na direção esperada” da borda
        if (direction === "next" && dx < 0) next({ restartTimer: true });      // borda direita: arrastar pra esquerda
        if (direction === "prev" && dx > 0) prev({ restartTimer: true });      // borda esquerda: arrastar pra direita
      }, { passive: true });

      // Clique (mouse) também funciona
      el.addEventListener("click", () => {
        direction === "next" ? next({ restartTimer: true }) : prev({ restartTimer: true });
      });
    }

    attachSwipe(edgeRight, "next");
    attachSwipe(edgeLeft, "prev");
    // ==============================================

    // Start
    loadCurrent();
    startCycle();
  </script>
</body>
</html>
